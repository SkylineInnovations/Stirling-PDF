-- H2 2.1.214;
SET DB_CLOSE_DELAY -1;        
;             
CREATE USER IF NOT EXISTS "SA" SALT '32bc3ec86fb16b9d' HASH '2b10b292e95c36c1025072b8ce2fe33e747ed93d2aa5ed708d6b3e9589ebb838' ADMIN;         
DROP TABLE IF EXISTS "PUBLIC"."AUTHORITIES" CASCADE;          
DROP TABLE IF EXISTS "PUBLIC"."PERSISTENT_LOGINS" CASCADE;    
DROP TABLE IF EXISTS "PUBLIC"."SESSIONS" CASCADE;             
DROP TABLE IF EXISTS "PUBLIC"."USER_SETTINGS" CASCADE;        
DROP TABLE IF EXISTS "PUBLIC"."USERS" CASCADE;
CREATE CACHED TABLE "PUBLIC"."AUTHORITIES"(
    "ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1 RESTART WITH 33) NOT NULL,
    "AUTHORITY" CHARACTER VARYING(255),
    "USER_ID" BIGINT
);      
ALTER TABLE "PUBLIC"."AUTHORITIES" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_A" PRIMARY KEY("ID");  
-- 2 +/- SELECT COUNT(*) FROM PUBLIC.AUTHORITIES;             
INSERT INTO "PUBLIC"."AUTHORITIES"("ID", "AUTHORITY", "USER_ID") VALUES(1, 'ROLE_ADMIN', 1);  
INSERT INTO "PUBLIC"."AUTHORITIES"("ID", "AUTHORITY", "USER_ID") VALUES(2, 'STIRLING-PDF-BACKEND-API-USER', 2);               
CREATE CACHED TABLE "PUBLIC"."PERSISTENT_LOGINS"(
    "SERIES" CHARACTER VARYING(255) NOT NULL,
    "LAST_USED" TIMESTAMP(6) NOT NULL,
    "TOKEN" CHARACTER VARYING(64) NOT NULL,
    "USERNAME" CHARACTER VARYING(64) NOT NULL
);      
ALTER TABLE "PUBLIC"."PERSISTENT_LOGINS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_A3" PRIMARY KEY("SERIES");       
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.PERSISTENT_LOGINS;       
CREATE CACHED TABLE "PUBLIC"."SESSIONS"(
    "SESSION_ID" CHARACTER VARYING(255) NOT NULL,
    "EXPIRED" BOOLEAN NOT NULL,
    "LAST_REQUEST" TIMESTAMP(6),
    "PRINCIPAL_NAME" CHARACTER LARGE OBJECT
);               
ALTER TABLE "PUBLIC"."SESSIONS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_8" PRIMARY KEY("SESSION_ID");             
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.SESSIONS;
CREATE CACHED TABLE "PUBLIC"."USER_SETTINGS"(
    "USER_ID" BIGINT NOT NULL,
    "SETTING_VALUE" CHARACTER LARGE OBJECT,
    "SETTING_KEY" CHARACTER VARYING(255) NOT NULL
);             
ALTER TABLE "PUBLIC"."USER_SETTINGS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_9" PRIMARY KEY("USER_ID", "SETTING_KEY");            
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.USER_SETTINGS;           
CREATE CACHED TABLE "PUBLIC"."USERS"(
    "USER_ID" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1 RESTART WITH 33) NOT NULL,
    "API_KEY" CHARACTER VARYING(255),
    "AUTHENTICATIONTYPE" CHARACTER VARYING(255),
    "ENABLED" BOOLEAN,
    "IS_FIRST_LOGIN" BOOLEAN,
    "PASSWORD" CHARACTER VARYING(255),
    "ROLE_NAME" CHARACTER VARYING(255),
    "USERNAME" CHARACTER VARYING(255)
);              
ALTER TABLE "PUBLIC"."USERS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_4" PRIMARY KEY("USER_ID");   
-- 2 +/- SELECT COUNT(*) FROM PUBLIC.USERS;   
INSERT INTO "PUBLIC"."USERS"("USER_ID", "API_KEY", "AUTHENTICATIONTYPE", "ENABLED", "IS_FIRST_LOGIN", "PASSWORD", "ROLE_NAME", "USERNAME") VALUES(1, NULL, 'web', TRUE, TRUE, '$2a$10$fP0AGXX55J1W.eDeBXKJU.5jOPk5fkLG975KdgxX0q9wzVQljcWIS', NULL, 'admin'); 
INSERT INTO "PUBLIC"."USERS"("USER_ID", "API_KEY", "AUTHENTICATIONTYPE", "ENABLED", "IS_FIRST_LOGIN", "PASSWORD", "ROLE_NAME", "USERNAME") VALUES(2, 'a0cf073c-c8e1-4059-b66f-e84ee1950286', 'web', TRUE, FALSE, '$2a$10$QEiRUhcwVVoaufp4QhxJduhy2JgQpmZ0LGQpXFaqiVYOL95FrhaMC', NULL, 'STIRLING-PDF-BACKEND-API-USER');      
ALTER TABLE "PUBLIC"."USERS" ADD CONSTRAINT "PUBLIC"."UKR43AF9AP4EDM43MMTQ01ODDJ6" UNIQUE("USERNAME");        
ALTER TABLE "PUBLIC"."AUTHORITIES" ADD CONSTRAINT "PUBLIC"."FKK91UPMBUEYIM93V469WJ7B2QH" FOREIGN KEY("USER_ID") REFERENCES "PUBLIC"."USERS"("USER_ID") NOCHECK;               
ALTER TABLE "PUBLIC"."USER_SETTINGS" ADD CONSTRAINT "PUBLIC"."FK8V82NJ88RMAI0NYCK19F873DW" FOREIGN KEY("USER_ID") REFERENCES "PUBLIC"."USERS"("USER_ID") NOCHECK;             
